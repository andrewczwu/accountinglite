generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          Int          @id @default(autoincrement())
  firebaseUid String       @unique
  email       String       @unique
  tenants     UserTenant[]
}

model Tenant {
  id              Int              @id @default(autoincrement())
  name            String
  users           UserTenant[]
  accounts        Account[]
  customers       Customer[]
  transactions    Transaction[]
}

model UserTenant {
  id       Int    @id @default(autoincrement())
  userId   Int
  user     User   @relation(fields: [userId], references: [id])
  tenantId Int
  tenant   Tenant @relation(fields: [tenantId], references: [id])
  role     String // 'ADMIN', 'USER'

  @@unique([userId, tenantId])
}

model Account {
  id           Int           @id @default(autoincrement())
  name         String
  type         String        // Asset, Liability, Equity, Income, Expense
  subtype      String?       // Bank, Credit Card, etc.
  cachedBalance Decimal       @default(0.0)
  tenantId     Int
  tenant       Tenant        @relation(fields: [tenantId], references: [id])
  lines        TransactionLine[]
}

model Customer {
  id           Int           @id @default(autoincrement())
  name         String
  firstName    String?
  lastName     String?
  isBusiness   Boolean       @default(false)
  email        String?
  phone        String?
  address      String?
  tenantId     Int
  tenant       Tenant        @relation(fields: [tenantId], references: [id])
  transactions Transaction[]
}

model Transaction {
  id          Int                @id @default(autoincrement())
  date        DateTime
  payee       String
  description String?
  customerId  Int?
  customer    Customer?          @relation(fields: [customerId], references: [id])
  tenantId    Int
  tenant      Tenant             @relation(fields: [tenantId], references: [id])
  lines       TransactionLine[]
  deletedAt   DateTime?
  createdAt   DateTime           @default(now())
  sequence    Int                @default(0)
}

model TransactionLine {
  id            Int         @id @default(autoincrement())
  transactionId Int
  transaction   Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  accountId     Int
  account       Account     @relation(fields: [accountId], references: [id])
  amount        Decimal
}
